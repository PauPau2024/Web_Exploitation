# **<span style="font-size: 23px">Path Traversal</span>** 

<span style="font-size: 17px">Path traversal is also known as directory traversal. These vulnerabilities enable an attacker to read arbitrary files on the server that is running an application. This might include:</span>

- <span style="font-size: 17px">Application code and data.</span>
- <span style="font-size: 17px">Credentials for back-end systems.</span>
- <span style="font-size: 17px">Sensitive operating system files.</span>

## **Reading arbitrary files via path traversal**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Imagine a shopping application that displays images of items for sale. This might load an image using the following HTML</span>

```vbscript-html
<img src="/loadImage?filename=218.png">
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">The </span>`loadImage`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> URL takes a </span>`filename`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> parameter and returns the contents of the specified file. The image files are stored on disk in the location </span>`/var/www/images/`

```vbscript-html
/var/www/images/218.png
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">This application implements no defenses against path traversal attacks. As a result, an attacker can request the following URL to retrieve the </span>`/etc/passwd`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> file from the server's filesystem:</span>

```vbscript-html
https://insecure-website.com/loadImage?filename=../../../etc/passwd
```

This causes the application to read from the following file path:

```vbscript-html
/var/www/images/../../../etc/passwd
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">On Windows, both </span>`../`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> and </span>`..\`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> are valid directory traversal sequences.On Linux </span><span style="font-family: Courier, monospace; color: rgb(92, 92, 91); font-size: 18px">../ </span>

## **Common obstacles to exploiting path traversal vulnerabilities**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Many applications that place user input into file paths implement defenses against path traversal attacks. These can often be bypassed.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">If an application strips or blocks directory traversal sequences from the user-supplied filename, it might be possible to bypass the defense using a variety of techniques.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">You might be able to use nested traversal sequences, such as </span>`....//`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> or </span>`....\/`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">. These revert to simple traversal sequences when the inner sequence is stripped.</span>

```vbscript-html
GET /image?filename=....//....//....//etc/passwd 
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">web servers may strip any directory traversal sequences before passing your input to the application. You can sometimes bypass this kind of sanitization by URL encoding, or even double URL encoding, the </span>`../`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> characters. This results in </span>`%2e%2e%2f`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> and </span>`%252e%252e%252f`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> respectively. Various non-standard encodings, such as </span>`..%c0%af`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> or </span>`..%ef%bc%8f`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">, may also work.</span>

```vbscript-html
GET /image?filename=..%252F..%252F..%252Fetc/passwd
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">An application may require the user-supplied filename to start with the expected base folder, such as </span>`/var/www/images`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">. In this case, it might be possible to include the required base folder followed by suitable traversal sequences</span>

```vbscript-html
filename=/var/www/images/../../../etc/passwd
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">An application may require the user-supplied filename to end with an expected file extension, such as </span>`.png`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">. In this case, it might be possible to use a null byte to effectively terminate the file path before the required extension.</span>

```vbscript-html
filename=../../../etc/passwd%00.png
```

## **How to prevent a path traversal attack**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">The most effective way to prevent path traversal vulnerabilities is to avoid passing user-supplied input to filesystem APIs altogether. Many application functions that do this can be rewritten to deliver the same behavior in a safer way.</span>

- <span style="font-size: 19px">Validate the user input before processing it. Ideally, compare the user input with a whitelist of permitted values. If that isn't possible, verify that the input contains only permitted content, such as alphanumeric characters only.</span>
- <span style="font-size: 19px">After validating the supplied input, append the input to the base directory and use a platform filesystem API to canonicalize the path. Verify that the canonicalized path starts with the expected base directory.</span>

```vbscript-html
File file = new File(BASE_DIRECTORY, userInput);
if (file.getCanonicalPath().startsWith(BASE_DIRECTORY)) {
    // process file
}
```