# Cross-site Scripting 

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Cross-site scripting (also known as XSS) is a web security vulnerability that allows an attacker to compromise the interactions that users have with a vulnerable application.</span>

## **How does XSS work?**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Cross-site scripting works by manipulating a vulnerable web site so that it returns malicious JavaScript to users.</span>

## **What are the types of XSS attacks?**

- [<span style="font-size: 17px">Reflected XSS</span>](https://portswigger.net/web-security/cross-site-scripting#reflected-cross-site-scripting)<span style="font-size: 17px">, where the malicious script comes from the current HTTP request.</span>
- [<span style="font-size: 17px">Stored XSS</span>](https://portswigger.net/web-security/cross-site-scripting#stored-cross-site-scripting)<span style="font-size: 17px">, where the malicious script comes from the website's database.</span>
- [<span style="font-size: 17px">DOM-based XSS</span>](https://portswigger.net/web-security/cross-site-scripting#dom-based-cross-site-scripting)<span style="font-size: 17px">, where the vulnerability exists in client-side code rather than server-side code.</span>

## [**Reflected cross-site scripting**](https://portswigger.net/web-security/cross-site-scripting/reflected)

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Reflected XSS is the simplest variety of cross-site scripting. It arises when an application receives data in an HTTP request and includes that data within the immediate response in an unsafe way.</span>

## [**Stored cross-site scripting**](https://portswigger.net/web-security/cross-site-scripting/stored)

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Stored XSS arises when an application receives data from an untrusted source and includes that data within its later HTTP responses in an unsafe way.</span>

## [**DOM-Based cross-site scripting**](https://portswigger.net/web-security/cross-site-scripting/stored)

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">DOM-Based XSS arises when an application contains some client-side JavaScript that processes data from an untrusted source in an unsafe way, usually by writing the data back to the DOM.</span>

## **What can XSS be used for?**

- <span style="font-size: 17px">Impersonate or masquerade as the victim user.</span>
- <span style="font-size: 17px">Carry out any action that the user is able to perform.</span>
- <span style="font-size: 17px">Read any data that the user is able to access.</span>
- <span style="font-size: 17px">Capture the user's login credentials.</span>
- <span style="font-size: 17px">Perform virtual defacement of the web site.</span>
- <span style="font-size: 17px">Inject trojan functionality into the web site.</span>

## **Impact of XSS vulnerabilities**

- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">In a brochureware application, where all users are anonymous and all information is public, the impact will often be minimal.</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">In an application holding sensitive data, such as banking transactions, emails, or healthcare records, the impact will usually be serious</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">If the compromised user has elevated privileges within the application, then the impact will generally be critical</span>

## **Content security policy**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Content security policy (CSP) is a browser mechanism that aims to mitigate the impact of cross-site scripting and some other vulnerabilities.CSP might hinder or prevent exploitation of the vulnerability.</span>

## **Dangling markup injection**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Dangling markup injection is a technique that can be used to capture data cross-domain in situations where a full cross-site scripting exploit is not possible, due to input filters or other defenses.</span>

# **Reflected XSS**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Reflected cross-site scripting (or XSS) arises when an application receives data in an HTTP request and includes that data within the immediate response in an unsafe way.</span>

**<span style="font-size: 19px">Example :</span>** 

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">a website has a search function which receives the user-supplied search term in a URL parameter:</span>

```http
https://insecure-website.com/search?term=gift
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">The application echoes the supplied search term in the response to this URL</span>

```http
<p>You searched for: gift</p>
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Assuming the application doesn't perform any other processing of the data, an attacker can construct an attack like this</span>

```http
https://insecure-website.com/search?term=<script>/*+Bad+stuff+here...+*/</script>
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">This URL results in the following response</span>

```http
<p>You searched for: <script>/* Bad stuff here... */</script></p>
```

## **Impact of reflected XSS attacks**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">If an attacker can control a script that is executed in the victim's browser, then they can typically fully compromise that user.</span>

- <span style="font-size: 17px">Perform any action within the application that the user can perform.</span>
- <span style="font-size: 17px">View any information that the user is able to view.</span>
- <span style="font-size: 17px">Modify any information that the user is able to modify.</span>
- <span style="font-size: 17px">Initiate interactions with other application users, including malicious attacks, that will appear to originate from the initial victim user.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">the impact of reflected XSS is generally less severe than </span>[stored XSS](https://portswigger.net/web-security/cross-site-scripting/stored)<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">,</span>

## **Reflected XSS in different contexts**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">The location of the reflected data within the application's response determines what type of payload is required to exploit it and might also affect the impact of the vulnerability.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">if the application performs any validation or other processing on the submitted data before it is reflected, this will generally affect what kind of XSS payload is needed.</span>

## **Finding and test for reflected XSS vulnerabilities**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Testing for reflected XSS vulnerabilities manually involves the following steps:</span>

**<span style="font-size: 17px">Test every entry point :</span>**<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Test separately every entry point for data within the application's HTTP requests. This includes parameters or other data within the URL query string and message body, and the URL file path</span>

**<span style="font-size: 17px">Submit random alphanumeric values :</span>** <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">For each entry point, submit a unique random value and determine whether the value is reflected in the response. The value should be designed to survive most input validation, so needs to be fairly short and contain only alphanumeric characters</span>

**<span style="font-size: 17px">Determine the reflection context :</span>** <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">For each location within the response where the random value is reflected, determine its context.</span>

**<span style="font-size: 17px">Test a candidate payload :</span>** <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Based on the context of the reflection, test an initial candidate XSS payload that will trigger JavaScript execution if it is reflected unmodified within the response.</span>

**<span style="font-size: 17px">Test alternative payloads :</span>** <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">If the candidate XSS payload was modified by the application, or blocked altogether, then you will need to test alternative payloads and techniques that might deliver a working XSS attack based on the context of the reflection and the type of input validation that is being performed.</span>

**<span style="font-size: 17px">Test the attack in a browser :</span>** <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Finally, if you succeed in finding a payload that appears to work within Burp Repeater, transfer the attack to a real browser (by pasting the URL into the address bar, or by modifying the request in </span>[Burp Proxy's intercept view](https://portswigger.net/burp/documentation/desktop/tools/proxy/intercept-messages)<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">, and see if the injected JavaScript is indeed executed.</span>

# **Stored XSS**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Stored cross-site scripting (also known as second-order or persistent XSS) arises when an application receives data from an untrusted source and includes that data within its later HTTP responses in an unsafe way.</span>

**<span style="font-size: 17px">Example :</span>** 

```http
POST /post/comment HTTP/1.1
Host: vulnerable-website.com
Content-Length: 100

postId=3&comment=This+post+was+extremely+helpful.&name=Carlos+Montoya&email=carlos%40normal-user.net
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">After this comment has been submitted, any user who visits the blog post will receive the following within the application's response:</span>

```http
<p>This post was extremely helpful.</p>
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Since this will run the malicous code for everyone user visiting the website it's an example of Stored XSS.</span>

## **Impact of stored XSS attacks**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">If an attacker can control a script that is executed in the victim's browser, then they can typically fully compromise that user. The attacker can carry out any of the actions that are applicable to the impact of </span>[reflected XSS vulnerabilities](https://portswigger.net/web-security/cross-site-scripting/reflected)<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">stored XSS vulnerability enables attacks that are self-contained within the application itself. The attacker does not need to find an external way of inducing other users to make a particular request containing their exploit.</span>

## **Finding and test for stored XSS vulnerabilities**

- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Entry points into the application's processing include:</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Parameters or other data within the URL query string and message body</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">URL file path</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">HTTP request headers that might not be exploitable in relation to </span>[<span style="font-size: 15px">reflected XSS</span>](https://portswigger.net/web-security/cross-site-scripting/reflected)

# **DOM-based XSS**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">DOM-based XSS vulnerabilities usually arise when JavaScript takes data from an attacker-controllable source, such as the URL, and passes it to a sink that supports dynamic code execution, such as </span>`eval()`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> or </span>`innerHTML`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">. This enables attackers to execute malicious JavaScript, which typically allows them to hijack other users' accounts.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">The most common source for DOM XSS is the URL, which is typically accessed with the </span>`window.location`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> object. An attacker can construct a link to send a victim to a vulnerable page with a payload in the query string and fragment portions of the URL.</span>

## **How to test for DOM-based cross-site scripting**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">To test for DOM-based cross-site scripting manually, you generally need to use a browser with developer tools, such as Chrome. You need to work through each available source in turn, and test each one individually.</span>

### **<span style="font-size: 17px">Testing HTML sinks</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">To test for DOM XSS in an HTML sink, place a random alphanumeric string into the source (such as </span>`location.search`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">), then use developer tools to inspect the HTML and find where your string appears.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">For each location where your string appears within the DOM, you need to identify the context. Based on this context, you need to refine your input to see how it is processed.</span>

### **<span style="font-size: 17px">Testing JavaScript execution sinks</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">your input doesn't necessarily appear anywhere within the DOM, so you can't search for it. Instead you'll need to use the JavaScript debugger to determine whether and how your input is sent to a sink.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">In Chrome's developer tools, you can use </span>`Control+Shift+F`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> (or </span>`Command+Alt+F`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> on MacOS) to search all the page's JavaScript code for the source</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Once you've found where the source is being read, you can use the JavaScript debugger to add a break point and follow how the source's value is used.</span>

### **<span style="font-size: 17px">Testing for DOM XSS using DOM Invader</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Identifying and exploiting DOM XSS in the wild can be a tedious process, often requiring you to manually trawl through complex, minified JavaScript. If you use Burp's browser, however, you can take advantage of its built-in DOM Invader extension, which does a lot of the hard work for you.</span>

## **Exploiting DOM XSS with different sources and sinks**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">In principle, a website is vulnerable to DOM-based cross-site scripting if there is an executable path via which data can propagate from source to sink.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">In practice, different sources and sinks have differing properties and behavior that can affect exploitability, and determine what techniques are necessary.</span>

**<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Example :</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">The </span>`document.write`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> sink works with </span>`script`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> elements, so you can use a simple payload, such as the one below:</span>

```http
document.write('... <script>alert(document.domain)</script> ...');
```

`document.write`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> includes some surrounding context that you need to take account of in your exploit.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">The </span>`innerHTML`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> sink doesn't accept </span>`script`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> elements on any modern browser, nor will </span>`svg onload`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> events fire. This means you will need to use alternative elements like </span>`img`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> or </span>`iframe`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">. Event handlers such as </span>`onload`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> and </span>`onerror`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> can be used in conjunction with these elements.</span>

```http
element.innerHTML='... <img src=1 onerror=alert(document.domain)> ...'
```

### **<span style="font-size: 17px">Sources and sinks in third-party dependencies</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Modern web applications are typically built using a number of third-party libraries and frameworks, which often provide additional functions and capabilities for developers. It's important to remember that some of these are also potential sources and sinks for DOM XSS.</span>

#### **<span style="font-size: 17px">DOM XSS in jQuery</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">If a JavaScript library such as jQuery is being used, look out for sinks that can alter DOM elements on the page</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">If data is read from a user-controlled source like the URL, then passed to the </span>`attr()`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> function, then it may be possible to manipulate the value sent to cause XSS.</span>

**<span style="font-size: 17px">Example :</span>**<span style="font-size: 17px"> </span>

```javascript
$(function() {
	$('#backLink').attr("href",(new URLSearchParams(window.location.search)).get('returnUrl'));
});
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">You can exploit this by modifying the URL so that the </span>`location.search`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> source contains a malicious JavaScript URL. After the page's JavaScript applies this malicious URL to the back link's </span>`href`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">, clicking on the back link will execute it:</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">=javascript:/\*Place your JavaScript Code to Exploit the website :/ \*/</span>

```javascript
?returnUrl=javascript:alert(document.domain)
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Another potential sink to look out for is jQuery's </span>`$()`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> selector function, which can be used to inject malicious objects into the DOM.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">jQuery used to be extremely popular, and a classic DOM XSS vulnerability was caused by websites using this selector in conjunction with the </span>`location.hash`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> source for animations or auto-scrolling to a particular element on the page. This behavior was often implemented using a vulnerable </span>`hashchange`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> event handle</span>

```javascript
$(window).on('hashchange', function() {
	var element = $(location.hash);
	element[0].scrollIntoView();
});
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">As the </span>`hash`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> is user controllable, an attacker could use this to inject an XSS vector into the </span>`$()`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> selector sink. More recent versions of jQuery have patched this particular vulnerability by preventing you from injecting HTML into a selector when the input begins with a </span>**<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">hash character (</span>**`#`**<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">).</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">exploit this classic vulnerability, you'll need to find a way to trigger a </span>`hashchange`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> event without user interaction. One of the simplest ways of doing this is to deliver your exploit via an </span>`iframe`

```javascript
<iframe src="https://vulnerable-website.com#" onload="this.src+='<img src=1 onerror=alert(1)>'">
```

#### **<span style="font-size: 17px">DOM XSS in AngularJS</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">framework like </span>[AngularJS](https://portswigger.net/web-security/cross-site-scripting/contexts/client-side-template-injection)<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> is used, it may be possible to execute JavaScript without angle brackets or events. When a site uses the </span>`ng-app`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> attribute on an HTML element, it will be processed by AngularJS. In this case, AngularJS will execute JavaScript inside double curly braces that can occur directly in HTML or inside attributes.</span>

```javascript
{{$on.constructor('alert(1)')()}}
```

## **<span style="font-size: 21px">DOM XSS combined with reflected and stored data</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">In a reflected DOM XSS vulnerability, the server processes data from the request, and echoes the data into the response. The reflected data might be placed into a JavaScript string literal, or a data item within the DOM, such as a form field. A script on the page then processes the reflected data in an unsafe way, ultimately writing it to a dangerous sink.</span>

```javascript
eval('var data = "reflected string"');
```

# [**Cross-site scripting**](https://portswigger.net/web-security/cross-site-scripting) **contexts**

- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">The location within the response where attacker-controllable data appears</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Any input validation or other processing that is being performed on that data by the application</span>

## **XSS between HTML tags**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">When the XSS context is text between HTML tags, you need to introduce some new HTML tags designed to trigger execution of JavaScript.</span>

```javascript
<script>alert(document.domain)</script>
<img src=1 onerror=alert(1)>
```

## **XSS in HTML tag attributes**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">When the XSS context is into an HTML tag attribute value, you might sometimes be able to terminate the attribute value, close the tag, and introduce a new one</span>

```javascript
"><script>alert(document.domain)</script>
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">More commonly in this situation, angle brackets are blocked or encoded, so your input cannot break out of the tag in which it appears.</span>

```javascript
" autofocus onfocus=alert(document.domain) x="
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">The above payload creates an </span>`onfocus`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> event that will execute JavaScript when the element receives the focus, and also adds the </span>`autofocus`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> attribute to try to trigger the </span>`onfocus`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> event automatically without any user interaction. Finally, it adds </span>`x="`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> to gracefully repair the following markup.</span>

```javascript
"onmouseover="alert('HAcker')"
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Sometimes the XSS context is into a type of HTML tag attribute that itself can create a scriptable context. Here, you can execute JavaScript without needing to terminate the attribute value. For example, if the XSS context is into the </span>`href`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> attribute of an anchor tag, you can use the </span>`javascript`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> pseudo-protocol to execute script</span>

```javascript
<a href="javascript:alert(document.domain)">
```

Note : sometimes a website url is mentioned inside a herf is vulnerable to javascript code execution.

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">You might encounter websites that encode angle brackets but still allow you to inject attributes. Sometimes, these injections are possible even within tags that don't usually fire events automatically, such as a canonical tag</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Access keys allow you to provide keyboard shortcuts that reference a specific element. The </span>`accesskey`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> attribute allows you to define a letter that, when pressed in combination with other keys (these vary across different platforms), will cause events to fire.</span>

## **XSS into JavaScript**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">When the XSS context is some existing JavaScript within the response, a wide variety of situations can arise, with different techniques necessary to perform a successful exploit.</span>

### **Terminating the existing script**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">In the simplest case, it is possible to simply close the script tag that is enclosing the existing JavaScript, and introduce some new HTML tags that will trigger execution of JavaScript.</span>

```javascript
<script>
...
var input = 'controllable data here';
...
</script>
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">you can use the following payload to break out of the existing JavaScript and execute your own:</span>

```javascript
</script><img src=1 onerror=alert(document.domain)>
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">The above payload leaves the original script broken, with an unterminated string literal. </span>

### **Breaking out of a JavaScript string**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">In cases where the XSS context is inside a quoted string literal, it is often possible to break out of the string and execute JavaScript directly. It is essential to repair the script following the XSS context,</span>

```javascript
'-alert(document.domain)-'
';alert(document.domain)//
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Some applications attempt to prevent input from breaking out of the JavaScript string by escaping any single quote characters with a backslash. A backslash before a character tells the JavaScript parser that the character should be interpreted literally, and not as a special character such as a string terminator</span>

<span style="font-size: 15px">For example, suppose that the input:</span>

`';alert(document.domain)//`

<span style="font-size: 15px">gets converted to:</span>

`\';alert(document.domain)//`

<span style="font-size: 15px">You can now use the alternative payload:</span>

`\';alert(document.domain)//`

<span style="font-size: 15px">which gets converted to:</span>

`\\';alert(document.domain)//`

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Some websites make XSS more difficult by restricting which characters you are allowed to use. This can be on the website level or by deploying a WAF that prevents your requests from ever reaching the website. In these situations, you need to experiment with other ways of calling functions which bypass these security measures. One way of doing this is to use the </span>`throw`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> statement with an exception handler. This enables you to pass arguments to a function without using parentheses. The following code assigns the </span>`alert()`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> function to the global exception handler and the </span>`throw`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> statement passes the </span>`1`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> to the exception handler (in this case </span>`alert`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">). The end result is that the </span>`alert()`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> function is called with </span>`1`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> as an argument.</span>

```javascript
onerror=alert;throw 1
```

### **<span style="font-size: 17px">Making use of HTML-encoding</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">When the XSS context is some existing JavaScript within a quoted tag attribute, such as an event handler, it is possible to make use of HTML-encoding to work around some input filters.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">When the browser has parsed out the HTML tags and attributes within a response, it will perform HTML-decoding of tag attribute values before they are processed any further. If the server-side application blocks or sanitizes certain characters that are needed for a successful XSS exploit, you can often bypass the input validation by HTML-encoding those characters.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">application blocks or escapes single quote characters, you can use the following payload to break out of the JavaScript string and execute your own script:</span>

```javascript
&apos;-alert(document.domain)-&apos;
```

### **<span style="font-size: 17px">XSS in JavaScript template literals</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">JavaScript template literals are string literals that allow embedded JavaScript expressions. The embedded expressions are evaluated and are normally concatenated into the surrounding text. Template literals are encapsulated in backticks instead of normal quotation marks, and embedded expressions are identified using the </span>`${...}`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> syntax.</span>

```javascript
document.getElementById('message').innerText = `Welcome, ${user.displayName}.`;
```

## **XSS via client-side template injection**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Some websites use a client-side template framework, such as AngularJS, to dynamically render web pages. If they embed user input into these templates in an unsafe manner, an attacker may be able to inject their own malicious template expressions that launch an XSS attack.</span>

# **Exploiting cross-site scripting vulnerabilities**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">The traditional way to prove that you've found a </span>[cross-site scripting](https://portswigger.net/web-security/cross-site-scripting)<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> vulnerability is to create a popup using the </span>`alert()`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> function. This isn't because </span>[XSS](https://portswigger.net/web-security/cross-site-scripting)<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> has anything to do with popups; it's simply a way to prove that you can execute arbitrary JavaScript on a given domain.</span>

## **Exploiting cross-site scripting to steal cookies**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Stealing cookies is a traditional way to exploit XSS. Most web applications use cookies for session handling. You can exploit cross-site scripting vulnerabilities to send the victim's cookies to your own domain, then manually inject the cookies into the browser and impersonate the victim.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">this approach has some significant limitations:</span>

- <span style="font-size: 17px">The victim might not be logged in.</span>
- <span style="font-size: 17px">Many applications hide their cookies from JavaScript using the </span>`HttpOnly`<span style="font-size: 17px"> flag.</span>
- <span style="font-size: 17px">Sessions might be locked to additional factors like the user's IP address.</span>
- <span style="font-size: 17px">The session might time out before you're able to hijack it.</span>