# **Authentication**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Authentication vulnerabilities can allow attackers to gain access to sensitive data and functionality. They also expose additional attack surface for further exploits</span>

- <span style="font-size: 17px">The most common authentication mechanisms used by websites.</span>
- <span style="font-size: 17px">Potential vulnerabilities in these mechanisms.</span>
- <span style="font-size: 17px">Inherent vulnerabilities in different authentication mechanisms.</span>
- <span style="font-size: 17px">Typical vulnerabilities that are introduced by their improper implementation.</span>
- <span style="font-size: 17px">How you can make your own authentication mechanisms as robust as possible.</span>

  ## <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Three main types of authentication:</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Something you </span>**know**<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">, such as a password</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Something you </span>**have**<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">, This is a physical object such as a mobile phone or security token.</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Something you </span>**are**<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> or do. For example, your biometrics or patterns of behavior</span>

## **<span style="font-size: 18px">Difference between authentication and authorization:</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Authentication is the process of verifying that a user is who they claim to be. Authorization involves verifying whether a user is allowed to do something.</span>

**<span style="font-size: 18px">How do authentication vulnerabilities arise?</span>**

- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">The authentication mechanisms are weak because they fail to adequately protect against brute-force attacks</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Logic flaws or poor coding in the implementation allow the authentication mechanisms to be bypassed entirely by an attacker. This is sometimes called "broken authentication"</span>

## **<span style="font-size: 18px">Vulnerabilities in password-based login</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">For websites that adopt a password-based login process, users either register for an account themselves or they are assigned an account by an administrator. This account is associated with a unique username and a secret password, which the user enters in a login form to authenticate themselves</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">the mere fact that they know the secret password is taken as sufficient proof of the user's identity. Consequently, the security of the website would be compromised if an attacker is able to either obtain or guess the login credentials of another user.</span>

# **Brute-force attacks**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">A brute-force attack is when an attacker uses a system of trial and error to guess valid user credentials.</span>

## **Username enumeration**

## <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">While attempting to brute-force a login page, you should pay particular attention to any differences in:</span>

**<span style="font-size: 18px">Status codes</span>**<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">:</span><span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> During a brute-force attack, the returned HTTP status code is likely to be the same for the vast majority of guesses because most of them will be wrong. If a guess returns a different status code, this is a strong indication that the username was correct.</span>

**<span style="font-size: 18px">Error messages</span>**<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">:</span><span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> Sometimes the returned error message is different depending on whether both the username AND password are incorrect or only the password was incorrect.</span>

**<span style="font-size: 18px">Response times</span>**<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">:</span><span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> If most of the requests were handled with a similar response time, any that deviate from this suggest that something different was happening behind the scenes. This is another indication that the guessed username might be correct.</span>

## **Flawed brute-force protection**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">The two most common ways of preventing brute-force attacks are:</span>

- <span style="font-size: 18px">Locking the account that the remote user is trying to access if they make too many failed login attempts</span>
- <span style="font-size: 18px">Blocking the remote user's IP address if they make too many login attempts in quick succession</span>

### **<span style="font-size: 21px">Account locking</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">One way in which websites try to prevent brute-forcing is to lock the account if certain suspicious criteria are met, usually a set number of failed login attempts. Just as with normal login errors, responses from the server indicating that an account is locked can also help an attacker to enumerate usernames.Locking an account offers a certain amount of protection against targeted brute-forcing of a specific account. However, this approach fails to adequately prevent brute-force attacks in which the attacker is just trying to gain access to any random account they can.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">the following method can be used to work around this kind of protection:</span>

- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Establish a list of candidate usernames that are likely to be valid.</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Decide on a very small shortlist of passwords that you think at least one user is likely to have.</span>
- <span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Using a tool such as Burp Intruder, try each of the selected passwords with each of the candidate usernames.</span>

### **<span style="font-size: 21px">User rate limiting</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Another way websites try to prevent brute-force attacks is through user rate limiting. In this case, making too many login requests within a short period of time causes your IP address to be blocked.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">IP can only be unblocked in one of the following ways:</span>

- <span style="font-size: 18px">Automatically after a certain period of time has elapsed</span>
- <span style="font-size: 18px">Manually by an administrator</span>
- <span style="font-size: 18px">Manually by the user after successfully completing a CAPTCHA</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">It is sometimes also possible to bypass this defense if you can work out how to guess multiple passwords with a single request.</span>

## **<span style="font-size: 23px">HTTP basic authentication</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">In HTTP basic authentication, the client receives an authentication token from the server, which is constructed by concatenating the username and password, and encoding it in Base64.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">token is stored and managed by the browser, which automatically adds it to the </span>`Authorization`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> header of every subsequent request as follows:</span>

```http
Authorization: Basic base64(username:password)
```

# **<span style="font-size: 23px">Vulnerabilities in multi-factor authentication</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Verifying biometric factors is impractical for most websites. However, it is increasingly common to see both mandatory and optional two-factor authentication (2FA) based on </span>**something you know**<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> and </span>**something you have**<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">. This usually requires users to enter both a traditional password and a temporary verification code from an out-of-band physical device in their possession.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Poorly implemented two-factor authentication can be beaten, or even bypassed entirely, just as single-factor authentication can.</span>

# **Two-factor authentication tokens**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">It is also common for websites to use a dedicated mobile app, such as Google Authenticator,</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">On the other hand, some websites send verification codes to a user's mobile phone as a text message.</span>

# **Bypassing two-factor authentication**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">If the user is first prompted to enter a password, and then prompted to enter a verification code on a separate page, the user is effectively in a "logged in" state before they have entered the verification code.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">In this case, it is worth testing to see if you can directly skip to "logged-in only" pages after completing the first authentication step.</span>

# **Flawed two-factor verification logic**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Sometimes flawed logic in two-factor authentication means that after a user has completed the initial login step, the website doesn't adequately verify that the same user is completing the second step.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">the user logs in with their normal credentials in the first step as follows</span>

```http
POST /login-steps/first HTTP/1.1
Host: vulnerable-website.com
...
username=carlos&password=qwerty
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">They are then assigned a cookie that relates to their account</span>

```http
HTTP/1.1 200 OK 
Set-Cookie: account=carlos 
GET /login-steps/second 
HTTP/1.1 Cookie: account=carlos
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">When submitting the verification code, the request uses this cookie to determine which account the user is trying to access:</span>

```http
POST /login-steps/second HTTP/1.1
Host: vulnerable-website.com
Cookie: account=carlos
...
verification-code=123456
```

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">In this case, an attacker could log in using their own credentials but then change the value of the </span>`account`<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> cookie to any arbitrary username when submitting the verification code.</span>

## **Brute-forcing 2FA verification codes**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">As with passwords, websites need to take steps to prevent brute-forcing of the 2FA verification code. This is especially important because the code is often a simple 4 or 6-digit number. Without adequate brute-force protection, cracking such a code is trivial.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Some websites attempt to prevent this by automatically logging a user out if they enter a certain number of incorrect verification codes. This is ineffective in practice because an advanced attacker can even automate this multi-step process by </span>[creating macros](https://portswigger.net/burp/documentation/desktop/settings/sessions#macros)<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px"> for Burp Intruder.</span>

# **<span style="font-size: 24px">Vulnerabilities in other authentication mechanisms</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Users can typically change their password or reset their password when they forget it. These mechanisms can also introduce vulnerabilities that can be exploited by an attacker.</span>

## **Resetting user passwords**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Some users will forget their password, so it is common to have a way for them to reset it. As the usual password-based authentication is obviously impossible in this scenario, websites have to rely on alternative methods to make sure that the real user is resetting their own password.</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Few different ways that this feature is commonly implemented</span>

### **Sending passwords by email :**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">Some websites generate a new password and send this to the user via email.</span>

### **Resetting passwords using a URL :**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">A more robust method of resetting passwords is to send a unique URL to users that takes them to a password reset page. Less secure implementations of this method use a URL with an easily guessable parameter to identify which account is being reset</span>

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">some websites fail to also validate the token again when the reset form is submitted. In this case, an attacker could simply visit the reset form from their own account, delete the token, and leverage this page to reset an arbitrary user's password</span>

**<span style="font-size: 17px">Password Reset Poisoning</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">If the URL in the reset email is generated dynamically, this may also be vulnerable to password reset poisoning. In this case, an attacker can potentially steal another user's token and use it change their password.</span>

## **Changing user passwords**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">changing your password involves entering your current password and then the new password twice. These pages fundamentally rely on the same process for checking that usernames and current passwords match as a normal login page does. Therefore, these pages can be vulnerable to the same techniques.</span>

# **<span style="font-size: 25px">Authentication vulnerabilities</span>**

<span style="font-family: Arial, Courier, sans-serif; color: rgb(92, 92, 91); font-size: 18px">authentication vulnerabilities are easy to understand. However, they are usually critical because of the clear relationship between authentication and security.</span>

- <span style="font-size: 19px">The most common authentication mechanisms used by websites.</span>
- <span style="font-size: 19px">Potential vulnerabilities in these mechanisms.</span>
- <span style="font-size: 19px">Inherent vulnerabilities in different authentication mechanisms.</span>
- <span style="font-size: 19px">Typical vulnerabilities that are introduced by their improper implementation.</span>
- <span style="font-size: 19px">How you can make your own authentication mechanisms as robust as possible.</span>

# **How to secure your authentication mechanisms**

- **Take care with user credentials**
- **Don't count on users for security**
- **Prevent username enumeration**
- **Implement robust brute-force protection**
- **Triple-check your verification logic**
- **Don't forget supplementary functionality**
- **Implement proper multi-factor authentication**